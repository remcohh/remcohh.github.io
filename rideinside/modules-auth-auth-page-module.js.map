{"version":3,"sources":["./src/app/modules/auth/auth.page.ts","./src/app/modules/auth/auth.page.module.ts","./src/app/modules/auth/auth.page.html","./src/app/modules/auth/auth-routing.module.ts","./src/app/modules/auth/auth.page.scss"],"names":[],"mappings":"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","file":"modules-auth-auth-page-module.js","sourcesContent":["import { HttpClient } from '@angular/common/http';\nimport { Component } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { Store } from '@ngxs/store';\nimport { IonicComponentLifecycles } from 'src/app/interfaces/component';\nimport { SetParticipantData } from 'src/app/store/actions/participant.actions';\nimport { ParticipantStateModel } from 'src/app/store/state/participant.state';\nimport { environment } from 'src/environments/environment';\n\n@Component({\n  selector: 'app-auth',\n  styleUrls: ['./auth.page.scss'],\n  templateUrl: './auth.page.html',\n})\nexport class AuthPage implements IonicComponentLifecycles {\n  constructor(\n    private http: HttpClient,\n    private router: Router,\n    private store: Store,\n  ) {}\n\n  ionViewDidEnter() {\n    this.verifyCode();\n  }\n\n  async verifyCode(): Promise<void> {\n    const ssoID = this.getCodeFromUrl();\n    if (!ssoID) {\n      this.router.navigate(['/', 'login']);\n      return;\n    }\n    this.getAccessToken(ssoID);\n  }\n\n  // FIXME: do proper url extraction\n  getCodeFromUrl(): string {\n    const query = window.location.search;\n    if (!!query) {\n      const urlParams = new URLSearchParams(query);\n      return urlParams.get('SSSOId');\n    }\n  }\n\n  async getAccessToken(ssoID) {\n    const headers = { apiKey: environment.apiKey };\n    this.http\n      .get(`${environment.authServer.token}/${ssoID}`, { headers })\n      .subscribe({\n        next: (response: any) => {\n          this.store.dispatch(\n            new SetParticipantData({\n              participantId: 'I6177031', // TODO first test student for now, should be response.ADFS.PersonID\n              sssoId: ssoID\n            })\n          );\n          this.router.navigate(['/', 'home']);\n        },\n        error: (e: any) => {\n          console.warn(e.message || e);\n          this.router.navigate(['/', 'login']);\n        },\n      });\n  }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { IonicModule } from '@ionic/angular';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { ElementsModule } from 'src/app/ui-components/elements/elements.module';\nimport { AuthPageRoutingModule } from './auth-routing.module';\nimport { AuthPage } from './auth.page';\n\n@NgModule({\n  imports: [\n    AuthPageRoutingModule,\n    CommonModule,\n    ElementsModule,\n    IonicModule,\n    TranslateModule,\n  ],\n  exports: [],\n  declarations: [AuthPage],\n  providers: [],\n})\nexport class AuthPageModule {}\n","export default \"<div class=\\\"mu-pt5\\\">\\n  <mu-spinner [variant]=\\\"'page'\\\">\\n    <h5 class=\\\"ion-text-center\\\">{{ 'auth-page.logging-in' | translate}}</h5>\\n  </mu-spinner>\\n</div>\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { AuthPage } from './auth.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AuthPage,\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AuthPageRoutingModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJhdXRoLnBhZ2Uuc2NzcyJ9 */\";"],"sourceRoot":"webpack:///"}